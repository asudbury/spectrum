function prependAddress(n,t,i){return'<option id="Address_'+n+'" value='+i+">"+t+"<\/option>"}function addressSelected(n){var t=document.getElementById("addressList"),i=t.options[n].value;$("#BuildingNumber").val(i);$("#Address").val(t[n].innerText)}function initialiseDatePicker(){$(".date").datetimepicker({dateFormat:"dd-M-yy",controlType:"select",hourMin:8,hourMax:20,stepMinute:5,oneLine:!0})}function manageError(n){console.log("The error to display is "+n);$("#errorText").text(n);$("#errorRow").show();$("#submit").text("Pay with Card");$("#submit").prop("disabled",!1)}function parseBraintreeError(n){var t="";switch(n.type){case"CUSTOMER":t=btCustomerError(n);break;case"MERCHANT":t="Merchant error please try again";break;case"NETWORK":t="Internal pay provider error please try again";break;case"INTERNAL":t="Internal pay provider error please try again";break;case"UNKNOWN":t="There has been an error please try again";break;default:t="Unexpected erorr. Please try again"}return t}function btCustomerError(n){var f="",t,r,u;switch(n.code){case"HOSTED_FIELDS_FIELDS_EMPTY":f="You must enter your card details";break;case"HOSTED_FIELDS_FIELDS_INVALID":if(t="",r="",n.details.invalidFieldKeys){for(u=n.details.invalidFieldKeys,i=0;i<u.length;i++)u[i]==="number"&&(r=t.length>0?" ,":"",t=t+r+" Card Number"),u[i]==="expirationMonth"&&(r=t.length>0?" ,":"",t=t+r+" Expiry month"),u[i]==="expirationYear"&&(r=t.length>0?" ,":"",t=t+r+" Expiry year"),u[i]==="cvv"&&(r=t.length>0?" ,":"",t=t+r+" cvv");f="Some of the fields are invalid - "+t}else f="Some of the fields are invalid";break;default:f="Unexpected braintree customer erorr. Please try again"}return f}function setupBraintree(n){n.paymentAmount&&($("#amount").prop("readonly",!0),$("#amount").val(n.paymentAmount));braintree.client.create({authorization:n.authToken},function(t,i){if(n.environment!=="production"&&($("#sandboxRibbon").text(n.environment),$("#sandboxRibbon").show(),$("#mobileSandboxRibbon").text(n.environment),$("#mobileSandboxRibbon").show()),t){console.error(t);return}braintree.hostedFields.create({client:i,styles:{input:{"font-size":"14px","font-family":"helvetica, tahoma, calibri, sans-serif",color:"#3a3a3a"},":focus":{color:"black"}},fields:{number:{selector:"#card-number",placeholder:"4111 1111 1111 1111"},cvv:{selector:"#cvv",placeholder:"123"},expirationMonth:{selector:"#expiration-month",placeholder:"MM"},expirationYear:{selector:"#expiration-year",placeholder:"YY"}}},function(t,i){if(t){console.error(t);return}i.on("validityChange",function(n){var t=n.fields[n.emittedBy];if(t.isValid){if(n.emittedBy==="expirationMonth"||n.emittedBy==="expirationYear"){if(!n.fields.expirationMonth.isValid||!n.fields.expirationYear.isValid)return}else n.emittedBy==="number"&&$("#card-number").next("span").text("");$(t.container).parents(".form-group").addClass("has-success")}else t.isPotentiallyValid?($(t.container).parents(".form-group").removeClass("has-warning"),$(t.container).parents(".form-group").removeClass("has-success"),n.emittedBy==="number"&&$("#card-number").next("span").text("")):($(t.container).parents(".form-group").addClass("has-warning"),n.emittedBy==="number"&&$("#card-number").next("span").text("Looks like this card number has an error."))});i.on("cardTypeChange",function(n){n.cards.length===1?$("#card-type").text(n.cards[0].niceType):$("#card-type").text("Card")});$("form").submit(function(t){$("#submit").prop("disabled",!0);var r="";$("#submit").text("Submitting...");t.preventDefault();i.tokenize(function(t,i){var u,f,e,o;if(t){console.error(JSON.stringify(t));r=parseBraintreeError(t);manageError(r);return}if(u=$("#amount").val(),f=/^\d+(?:\.\d{0,2})$/,!f.test(u)){console.log("amount is invalid");r="The amount is invalid. You must specify pounds and pence 0.0";manageError(r);return}e=$("#fklfkl").val();o={code:e,currentPageNodeId:n.nodeId,nonce:i.nonce,amount:u,autoAllocate:n.autoAllocate,invoiceId:n.invoiceId,clientId:n.clientId,customerId:n.customerId};$.ajax({url:n.makePaymentUrl,type:"POST",dataType:"json",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",success:function(n){console.log("Server success "+n);window.location.href=n},error:function(n,t,i){console.log("Server error "+i);window.location.href="/error"}})})})})})}$(document).ready(function(){$("#findAddress").click(function(){var n=$("#PostCode").val(),t,r;if(n)$(".find-address + span").removeClass("field-validation-error"),$(".find-address + span").addClass("field-validation-valid"),$(".find-address + span").text("");else{console.log("postcode is empty");$(".find-address + span").addClass("field-validation-error");$(".find-address + span").removeClass("field-validation-valid");$(".find-address + span").text("Please enter a postcode");return}$("#addressList").empty();t="/umbraco/Surface/Search/GetAddresses";r={buildingNumber:"",postCode:n};$("#loading").removeClass("disp-none");$("#addressList").addClass("disp-none");$(".find-address").addClass("disp-none");$.ajax({url:t,type:"POST",dataType:"json",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",success:function(n){for($("#loading").addClass("disp-none"),$("#addressList").removeClass("disp-none"),$(".find-address").removeClass("disp-none"),$("#BuildingNumber").val(""),i=0;i<n.length;i++)$("#addressList").prepend(prependAddress(i,n[i].Address,n[i].BuildingNumber));var t=$("#addressList"),r=t.children("option");t.append(r.get().reverse());$("#addressList").prepend('<option value="" disabled="disabled" selected="selected">Please select address<\/option>')},error:function(){$("#loading").addClass("disp-none");$(".find-address").removeClass("disp-none");$("#addressList").removeClass("disp-none");window.location.href="/error"}})})});